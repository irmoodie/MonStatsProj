---
title: "Effect of competition on a threatened species"
subtitle: "*Centaurea Corymbosa*"
author: "D. Groffman, I. Moodie, B. Shahid"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)


```

## Study species

*Centaurea corymbosa* is an endemic plant species of La Clape, an region in Southern France.

It is closely related to other *Centaurea* species found in the region, but unlike *C. corymbosa*, these are very abundant.

```{r, echo=FALSE, out.width = '50%', fig.align='center', fig.cap="*C. corymbosa*"}
   knitr::include_graphics("Data_Slides_Figs/corymbosa.jfif")

```

## Our question

Is *Centaurea corymbosa* threatened because it is not as competitive as other *Centaurea* species?

## The experiment (1/2)

- Seeds of two *Centaurea* species were collected from **four** populations, **two** with only *C. corymbosa* present and **two** with only *C. maculosa* present.
- Seeds were sown one per pot.
- Competition was induced by growing *Brachypodium ramosum* in the pots, but at different densities:
  - Control: no *B. ramosum*
  - Not dense: *B. ramosum* covers **10%** of the surface area of the pot
  - Dense: *B. ramosum* covers **between 10 and 50%** of the surface area of the pot
  - Very dense: *B. ramosum* covers **more than 50%** of the surface area of the pot
  
## The experiment (2/2)

For each treatment, **50 replicates** were seeded for **each population** and **each species**, for a **total of 800 seeds** monitored at different time intervals: each week for 3 weeks, and then once per month*.

|            | C.c. (Pop1)            | C.c. (Pop2)            | C.m. (Pop3)            | C.m. (Pop4)            |
| ---------- | ---------------------- | ---------------------- | ---------------------- | ---------------------- |
| Control    | C.c. (Pop1)/Control    | C.c. (Pop2)/Control    | C.m. (Pop3)/Control    | C.m. (Pop4)/Control    |
| Not Dense  | C.c. (Pop1)/Not Dense  | C.c. (Pop2)/Not Dense  | C.m. (Pop3)/Not Dense  | C.m. (Pop4)/Not Dense  |
| Dense      | C.c. (Pop1)/Dense      | C.c. (Pop2)/Dense      | C.m. (Pop3)/Dense      | C.m. (Pop4)/Dense      |
| Very Dense | C.c. (Pop1)/Very Dense | C.c. (Pop2)/Very Dense | C.m. (Pop3)/Very Dense | C.m. (Pop4)/Very Dense |

## The dataset (1/2)

- *Plante*: number of the seed/plant (1 to 800)
- *Espece*: species (mac, C. maculosa, cor, C. corymbosa)
- *Pop*: population names
- *Traitement*: treatment factor
- *PAR*: quantity of light received by a pot, which depends on the percentage of soil covers ; it is 100% in control pots
- *Reference*: quantity of light received by a pot where it is not covered. it is 100% in control pots 

## The dataset (2/2)

- *Date_de_germination*: germination date; missing data if the seed did not germinate 
- *Cotyledons*: size of the emerged seedling
- *Taille_Dec_05*: size of the rosette in December 2005
- *Taille_Fev_06*: size of the rosette in Feburary 2006
- *Taille_Mars_06*: size of the rosette in March 2006
- *Taille_Juin_06*: size of the rosette in June 2006
- *Taille_Sept_06*: size of the rosette in September 2006

## Data cleaning (1/n)

```{r, cleaning, echo=TRUE, include=TRUE}

# Format the date of germination correctly
data$Date_de_germination <- as.Date(data$Date_de_germination,
                                    format = "%d/%m/%Y")

head(data[1:3,1:5])

```


## Data cleaning (2/n)

```{r, warning=FALSE}

gathered_data <- data %>%
  rename("2005-12-01" = "Taille_Dec_05",
         "2006-02-01" = "Taille_Fev_06",
         "2006-03-01" = "Taille_Mars_06",
         "2006-06-01" = "Taille_Juin_06",
         "2006-09-01" = "Taille_Sept_06") %>%
  gather(key = "Date", 
         value = "Rosette_size", 
         "2005-12-01":"2006-09-01")

gathered_data$Date <- as.Date(gathered_data$Date, format = "%Y-%m-%d")

ggplot(gathered_data, aes(x = (1-light), y = Rosette_size, colour = pop)) +
  geom_jitter(alpha = 0.3, size = 2) +
  facet_grid(espece~Date) +
  labs(x = "1-PAR/ref (0 = max light recieved & min competition)",
       y = "Rosette size") +
  theme(axis.text.x = element_text(angle = 90)) +
    theme(axis.text=element_text(size=12),
        strip.text = element_text(size = 12),
        axis.title=element_text(size=14,face="bold"))

ggsave(filename = "x1minusParRef_yRosette_facSpecDate_GrpPop.png",
       dpi = "retina",
       height = 6,
       width = 12)

gathered_data$traitement <- factor(gathered_data$traitement,      # Reordering group factor levels
                         levels = c("temoin", "peu", "mi", "dense"))

ggplot(gathered_data, aes(x = Date, y = Rosette_size, colour = pop)) +
  geom_jitter(alpha = 0.3, size = 2) +
  facet_grid(espece~traitement) +
  scale_x_continuous(breaks = as.numeric(gathered_data$Date),
                     labels = format(gathered_data$Date, format = "%b")) +
    theme(axis.text.x = element_text(angle = 90)) +
    labs(y = "Rosette size") +
  theme(axis.text=element_text(size=12),
        strip.text = element_text(size = 12),
        axis.title=element_text(size=14,face="bold"))

ggsave(filename = "xDate_yRosette_facSpecTrait_GrpPop.png",
       dpi = "retina",
       height = 6,
       width = 12)

ggplot(gathered_data, aes(x = traitement, y = Rosette_size, colour = pop)) +
  geom_jitter(alpha = 0.3, size = 2) +
  facet_grid(espece~Date) +
  #scale_x_continuous(breaks = as.numeric(gathered_data$Date),
  #                   labels = format(gathered_data$Date, format = "%b")) +
    theme(axis.text.x = element_text(angle = 90)) +
    labs(y = "Rosette size") +
  theme(axis.text=element_text(size=12),
        strip.text = element_text(size = 12),
        axis.title=element_text(size=14,face="bold"))

ggsave(filename = "xTraitement_yRosette_facSpecDate_GrpPop.png",
       dpi = "retina",
       height = 6,
       width = 12)

hist(gathered_data$Rosette_size)

#  scale_x_continuous(breaks = as.numeric(gathered_data$Date),
 #                    labels = format(gathered_data$Date, format = "%b")) +

lm1 <- lm(Rosette_size~light+espece+pop+Cotyledons+Date, data = gathered_data)

lm2 <- lm(Rosette_size~light, data = gathered_data)

summary(lm2)
plot(lm2)

```

## Data cleaning (3/n)

1st decision - We are not interested in the rosette size of plants that do not germinate, so set to NA

```{r, cleaning2, echo=TRUE, include=TRUE, results='hide'}

# If plant didn't germinate, it should not have a rosette size
data_nogerm <- data %>%
  filter(is.na(Date_de_germination)) %>%
  mutate(Taille_Dec_05 = NA,
         Taille_Fev_06 = NA,
         Taille_Mars_06 = NA,
         Taille_Juin_06 = NA,
         Taille_Sept_06 = NA) %>%
  mutate(germ = 0)

data_germ <- data %>%
  filter(!is.na(Date_de_germination)) %>%
  mutate(germ = 1)

data_nogerm_na <- full_join(data_nogerm, data_germ)

```

## Data cleaning (4/n)

3rd decision: To make sense of the light data, we divide the PAR received by the plant through the *Brachypodium* by the max PAR that pot was receiving (actual/max possible). As the max values were taken for areas within the greenhouse (presumed), not each pot, some values of actual/max are slightly above 1.
```{r, cleaning4, echo=TRUE, include=TRUE}
gathered_data <- gathered_data %>%
  mutate(light = PAR/reference)
```

## Data exploration (1/n)

```{r, explore1, echo=FALSE, include=TRUE, warning = FALSE, fig.align='center'}
ggplot(gathered_data, aes(x = traitement, y = PAR/reference, colour = interaction(pop,espece))) +
  geom_jitter(alpha = 0.3, size = 2) +
  scale_y_continuous(breaks = c(0,0.25,0.5,0.75,1)) +
    theme(axis.text=element_text(size=12),
        axis.title=element_text(size=14,face="bold"))

ggsave(filename = "xTraitement_yParRef_GrpSpecPop.png",
       dpi = "retina",
       height = 7,
       width = 9)

```
